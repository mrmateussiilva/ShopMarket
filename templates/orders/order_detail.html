{% extends 'base.html' %}

{% block title %}Pedido #{{ order.id }} - ShopMarket{% endblock %}

{% block content %}
<div class="container">
    <h1>Pedido #{{ order.id }}</h1>

    <div class="order-detail">
        <div class="order-status-section">
            <h3>Status: <span class="status-{{ order.status }}">{{ order.get_status_display }}</span></h3>
            <p>Data do pedido: {{ order.created_at|date:"d/m/Y H:i" }}</p>
        </div>

        <div class="order-info-section">
            <h3>Informações do Pedido</h3>
            <p><strong>Loja:</strong> {{ order.store.name }}</p>
            <p><strong>Método de Entrega:</strong> {{ order.get_delivery_method_display }}</p>
            <p><strong>Método de Pagamento:</strong> {{ order.get_payment_method_display }}</p>

            {% if order.delivery_address %}
            <p><strong>Endereço de Entrega:</strong><br>{{ order.delivery_address }}</p>
            {% endif %}

            {% if order.delivery_notes %}
            <p><strong>Observações:</strong><br>{{ order.delivery_notes }}</p>
            {% endif %}
        </div>

        <div class="order-items-section">
            <h3>Itens do Pedido</h3>
            <table class="order-items-table">
                <thead>
                    <tr>
                        <th>Produto</th>
                        <th>Código</th>
                        <th>Quantidade</th>
                        <th>Preço Unit.</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in order.items.all %}
                    <tr>
                        <td>{{ item.product_name }}</td>
                        <td>{{ item.product_code }}</td>
                        <td>{{ item.quantity }}</td>
                        <td>R$ {{ item.unit_price }}</td>
                        <td>R$ {{ item.total_price }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="order-totals-section">
            <div class="total-row">
                <span>Total de Produtos:</span>
                <span>R$ {{ order.products_total }}</span>
            </div>

            {% if order.discount_total > 0 %}
            <div class="total-row">
                <span>Desconto:</span>
                <span>-R$ {{ order.discount_total }}</span>
            </div>
            {% endif %}

            <div class="total-row subtotal">
                <strong>Total do Pedido:</strong>
                <strong>R$ {{ order.subtotal }}</strong>
            </div>
        </div>

        <div class="order-actions">
            <a href="{% url 'order_list' %}" class="btn btn-secondary">Voltar para Meus Pedidos</a>
            <a href="{% url 'repeat_order' order.id %}" class="btn btn-primary">Repetir Pedido</a>
        </div>
    </div>
</div>
{% endblock %}