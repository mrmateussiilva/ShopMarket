{% extends 'base.html' %}

{% block title %}{{ product.name }} - {{ shop.name }}{% endblock %}

{% block content %}
<div class="container catalog-layout">
    <nav class="breadcrumbs">
        <a href="{% url 'home' %}">Home</a>
        <a href="{% url 'category_list' product.category.slug %}">{{ product.category.name }}</a>
        <span>{{ product.name }}</span>
    </nav>

    <div class="product-pdp">
        <div class="pdp-gallery">
            {% if product.images.first %}
            <img src="{{ product.images.first.image.url }}" alt="{{ product.name }}">
            {% else %}
            <img src="https://via.placeholder.com/600x600?text={{ product.name|urlencode }}" alt="{{ product.name }}">
            {% endif %}
        </div>

        <div class="pdp-info">
            <h1>{{ product.name }}</h1>
            <div class="pdp-code">C√≥digo: {{ product.code }} | Unidade: {{ product.unit }}</div>

            {% if product.price %}
            <div class="pdp-price-box">
                {% if product.price.has_discount %}
                <div class="price-old">De: R$ {{ product.price.regular_price }}</div>
                {% endif %}
                <div class="price-main">
                    {% if product.price.has_discount %}
                    <span
                        style="font-size: 1rem; color: var(--text-muted); font-weight: normal; align-self: center; margin-right: 8px;">Por:</span>
                    {% endif %}
                    <span class="price-prefix">R$</span>{{ product.price.get_best_price }}
                </div>
                {% if product.price.has_discount %}
                <div class="pdp-savings">
                    Economia de R$ {{ product.price.regular_price|add:product.price.get_best_price }}
                </div>
                {% endif %}
            </div>

            <div class="pdp-actions">
                <form method="post" action="{% url 'cart_add' product.id %}" class="add-to-cart-form">
                    {% csrf_token %}
                    <label
                        style="display: block; font-weight: 700; margin-bottom: 12px; font-size: 0.9rem; color: var(--text);">Selecione
                        a quantidade:</label>
                    <div class="quantity-controls" style="width: 140px; margin-bottom: 20px;">
                        <button type="button" class="btn-qty btn-qty-minus" onclick="decrementQty(this)"
                            aria-label="Remover"><span>-</span></button>
                        <input type="number" name="quantity" value="1" min="1" max="99" class="input-qty"
                            aria-label="Quantidade">
                        <button type="button" class="btn-qty btn-qty-plus" onclick="incrementQty(this)"
                            aria-label="Adicionar"><span>+</span></button>
                    </div>

                    <input type="hidden" name="next" value="{{ request.path }}">
                    <button type="submit" class="btn-buy" style="padding: 18px; font-size: 1.2rem; width: 100%;">
                        <span class="icon">üõí</span> Adicionar ao Carrinho
                    </button>
                </form>

                {% if user.is_authenticated %}
                <form method="post" action="{% url 'list_add_product_quick' product.id %}">
                    {% csrf_token %}
                    <input type="hidden" name="next" value="{{ request.path }}">
                    <button type="submit" class="btn-outline"
                        style="width: 100%; margin-top: 5px; padding: 15px; border-radius: 8px; font-weight: 600;">
                        ‚ù§Ô∏è Salvar na Minha Lista
                    </button>
                </form>
                {% else %}
                <a href="{% url 'login' %}?next={{ request.path }}" class="btn-outline"
                    style="display: block; width: 100%; margin-top: 5px; padding: 15px; border-radius: 8px; font-weight: 600; text-decoration: none; text-align: center;">
                    ‚ù§Ô∏è Salvar na Minha Lista
                </a>
                {% endif %}
            </div>
            {% else %}
            <div style="padding: 30px; background: #FFF5F5; border-left: 4px solid var(--danger); border-radius: 8px;">
                <p style="color: var(--danger); font-weight: 700; margin: 0; font-size: 1.1rem;">Produto temporariamente
                    indispon√≠vel</p>
                <p style="color: var(--text-muted); font-size: 0.9rem; margin: 8px 0 0;">Avise-me quando chegar este
                    item.</p>
            </div>
            {% endif %}

            {% if product.description %}
            <div class="pdp-description">
                <h3>Descri√ß√£o do Produto</h3>
                <div class="pdp-description-content">{{ product.description|linebreaks }}</div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Related Products -->
    {% if related_products %}
    <section class="vitrine" style="margin-top: 80px;">
        <div class="section-header">
            <h2 class="section-title">Aqui tem mais op√ß√µes</h2>
        </div>
        <div class="products-grid">
            {% for rel_product in related_products %}
            {% include 'components/product_card.html' with product=rel_product price=rel_product.price %}
            {% endfor %}
        </div>
    </section>
    {% endif %}
</div>
{% endblock %}