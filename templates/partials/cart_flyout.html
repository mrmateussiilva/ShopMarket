<div id="cart-flyout" class="cart-flyout">
    <div class="cart-flyout-overlay" onclick="toggleCart()"></div>
    <div class="cart-flyout-content">
        <div class="cart-flyout-header">
            <h3>üõí Meu Carrinho</h3>
            <button class="btn-close-cart" onclick="toggleCart()">‚úï</button>
        </div>

        <div class="cart-flyout-body">
            {% if cart %}
            <div class="cart-items-list">
                {% for item in cart %}
                {% with product=item.product %}
                <div class="cart-item">
                    <div class="cart-item-img">
                        {% if product.images.first %}
                        <img src="{{ product.images.first.image.url }}" alt="{{ product.name }}">
                        {% else %}
                        <img src="https://via.placeholder.com/60x60?text={{ product.name|urlencode }}"
                            alt="{{ product.name }}">
                        {% endif %}
                    </div>
                    <div class="cart-item-details">
                        <h4 class="cart-item-name">{{ product.name }}</h4>
                        <div class="cart-item-price-qty">
                            <span>{{ item.quantity }}x R$ {{ item.price }}</span>
                            <strong>R$ {{ item.total_price }}</strong>
                        </div>
                    </div>
                    <a href="{% url 'cart_remove' product.id %}" class="btn-remove-item" title="Remover">üóëÔ∏è</a>
                </div>
                {% endwith %}
                {% endfor %}
            </div>
            {% else %}
            <div class="cart-empty">
                <span class="icon">üõí</span>
                <p>Seu carrinho est√° vazio</p>
                <button class="btn-buy" onclick="toggleCart()">Come√ßar a comprar</button>
            </div>
            {% endif %}
        </div>

        {% if cart %}
        <div class="cart-flyout-footer">
            <div class="cart-summary">
                <div class="summary-row">
                    <span>Subtotal</span>
                    <span>R$ {{ cart.get_total_price }}</span>
                </div>
                <!-- Delivery info or discounts could go here -->
                <div class="summary-row total">
                    <span>Total</span>
                    <strong>R$ {{ cart.get_total_price }}</strong>
                </div>
            </div>
            <div class="cart-actions">
                <a href="{% url 'cart_detail' %}" class="btn-view-cart">Ver Carrinho</a>
                <a href="#" class="btn-checkout">Finalizar Compra</a>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<script>
    function toggleCart() {
        const flyout = document.getElementById('cart-flyout');
        flyout.classList.toggle('active');
        document.body.classList.toggle('no-scroll');
    }
</script>